<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Funbox - Mi Perfil</title>
    <style>
        body { background: #0a0a0a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { background: #151515; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .coins { background: #ffca28; color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 18px; box-shadow: 0 0 10px rgba(255, 202, 40, 0.3); }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .character-view { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a1a 0%, #050505 100%); position: relative; }
        #char-3d-container { width: 500px; height: 500px; cursor: grab; filter: drop-shadow(0 10px 40px rgba(0,0,0,0.9)); }
        .char-name { margin-top: 10px; font-size: 28px; color: #4db8ff; font-weight: bold; text-shadow: 0 0 15px rgba(77, 184, 255, 0.4); }
        .btn-play-now { margin-top: 20px; background: #4caf50; color: white; border: none; padding: 12px 40px; font-size: 18px; font-weight: bold; border-radius: 30px; cursor: pointer; transition: 0.3s; box-shadow: 0 0 20px rgba(76, 175, 80, 0.4); }
        .btn-play-now:hover { transform: scale(1.05); background: #66bb6a; }
        .shop-container { width: 400px; background: #111; border-left: 1px solid #333; padding: 20px; overflow-y: auto; }
        .item-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .item-card { background: #1a1a1a; border: 1px solid #333; padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; transition: 0.2s; }
        .item-card:hover { border-color: #4db8ff; }
        .item-card.selected { border-color: #4caf50; background: rgba(76, 175, 80, 0.1); border-width: 2px; }
        .item-emoji { font-size: 40px; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold; font-size: 20px;">üë§ PERFIL DE USUARIO</div>
    <div class="coins">ü™ô <span id="coin-count">500</span></div>
</div>

<div class="main-container">
    <div class="character-view">
        <div id="char-3d-container"></div>
        <div id="user-display-name" class="char-name">Usuario</div>
        <button class="btn-play-now" onclick="location.href='play.html'">üéÆ JUGAR AHORA</button>
    </div>
    <div class="shop-container">
        <div style="color: #888; font-size: 12px; margin-bottom: 10px; letter-spacing: 1px;">MI INVENTARIO</div>
        <div class="item-grid" id="inventory-items"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
    const userSession = JSON.parse(sessionStorage.getItem("funbox_session")) || { user: "Jugador" };
    document.getElementById("user-display-name").innerText = userSession.user;

    let ownedItems = JSON.parse(localStorage.getItem("funbox_items")) || ["üë®", "ü•∑", "ü§ñ"];
    let currentSkin = localStorage.getItem("funbox_current_skin") || "üë®";

    function renderInventory() {
        const container = document.getElementById("inventory-items");
        container.innerHTML = "";
        ownedItems.forEach(emoji => {
            const card = document.createElement("div");
            card.className = "item-card" + (currentSkin === emoji ? " selected" : "");
            card.onclick = () => {
                currentSkin = emoji;
                localStorage.setItem("funbox_current_skin", emoji);
                renderInventory();
                updateCharacterPreview();
            };
            card.innerHTML = `<span class="item-emoji">${emoji}</span><div style="font-size: 10px; color: #888;">${emoji === "üë®" ? "CL√ÅSICO" : "SKIN"}</div>`;
            container.appendChild(card);
        });
    }

    let scene, camera, renderer, charGroup;

    function init3D() {
        const container = document.getElementById('char-3d-container');
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(40, 1, 0.1, 1000);
        camera.position.set(0, 0.7, 3.2);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(500, 500);
        container.appendChild(renderer.domElement);

        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 5);
        scene.add(light);

        charGroup = new THREE.Group();
        scene.add(charGroup);

        updateCharacterPreview();

        let isDragging = false, startX = 0;
        container.onmousedown = (e) => { isDragging = true; startX = e.clientX; };
        window.onmouseup = () => isDragging = false;
        window.onmousemove = (e) => {
            if (isDragging) {
                charGroup.rotation.y += (e.clientX - startX) * 0.01;
                startX = e.clientX;
            }
        };

        function animate() {
            requestAnimationFrame(animate);
            if (!isDragging) charGroup.rotation.y += 0.005;
            charGroup.position.y = -0.4 + Math.sin(Date.now() * 0.002) * 0.05;
            renderer.render(scene, camera);
        }
        animate();
    }

    function updateCharacterPreview() {
        while(charGroup.children.length > 0){ charGroup.remove(charGroup.children[0]); }

        if (currentSkin === "üë®") {
            // Cabeza C√∫bica
            const head = new THREE.Mesh(
                new THREE.BoxGeometry(0.7, 0.7, 0.7),
                new THREE.MeshStandardMaterial({ color: 0xc4a484 })
            );
            head.position.y = 0.85;

            // Pelo
            const hair = new THREE.Mesh(
                new THREE.BoxGeometry(0.72, 0.22, 0.72),
                new THREE.MeshStandardMaterial({ color: 0x3d2b1f })
            );
            hair.position.y = 0.25;
            head.add(hair);

            // Ojos Cute Grandes
            const eyeGeo = new THREE.CircleGeometry(0.16, 32);
            const eyeMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const eL = new THREE.Mesh(eyeGeo, eyeMat);
            eL.position.set(-0.22, -0.05, 0.36);
            const eR = eL.clone();
            eR.position.x = 0.22;
            
            const shine = new THREE.Mesh(new THREE.CircleGeometry(0.05, 16), new THREE.MeshBasicMaterial({color: 0xffffff}));
            shine.position.set(0.06, 0.06, 0.01);
            eL.add(shine); eR.add(shine.clone());
            head.add(eL, eR);

            // Auriculares
            const pMat = new THREE.MeshStandardMaterial({ color: 0x007ceb });
            const pL = new THREE.Mesh(new THREE.CylinderGeometry(0.18, 0.18, 0.12, 32), pMat);
            pL.rotation.z = Math.PI/2; pL.position.x = -0.42;
            const pR = pL.clone(); pR.position.x = 0.42;
            head.add(pL, pR);

            // Cuerpo C√°psula
            const body = new THREE.Mesh(
                new THREE.CapsuleGeometry(0.32, 0.6, 4, 16),
                new THREE.MeshStandardMaterial({ color: 0x005a9e })
            );
            body.position.y = 0.25;

            // PATAS (Las que pediste)
            const footGeo = new THREE.SphereGeometry(0.14, 16, 16);
            const footMat = new THREE.MeshStandardMaterial({ color: 0x004070 });
            const footL = new THREE.Mesh(footGeo, footMat);
            footL.position.set(-0.16, -0.15, 0.05);
            footL.scale.y = 0.6;
            const footR = footL.clone();
            footR.position.x = 0.16;

            charGroup.add(head, body, footL, footR);
        } else {
            // Placeholder para otros personajes
            const mystery = new THREE.Mesh(
                new THREE.TorusKnotGeometry(0.3, 0.1, 64, 8),
                new THREE.MeshStandardMaterial({ color: 0x4db8ff })
            );
            mystery.position.y = 0.5;
            charGroup.add(mystery);
        }
    }

    renderInventory();
    window.onload = init3D;
</script>
</body>
</html>
