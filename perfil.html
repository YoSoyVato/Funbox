<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Funbox - Mi Perfil</title>
    <style>
        body { background: #0a0a0a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Header con Monedas */
        .header { background: #151515; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .coins { background: #ffca28; color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 18px; box-shadow: 0 0 10px rgba(255, 202, 40, 0.3); }

        .main-container { display: flex; flex: 1; overflow: hidden; }

        /* Lado Izquierdo: Visualizador de Personaje */
        .character-view { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a1a 0%, #050505 100%); position: relative; }
        
        /* Contenedor del Personaje 3D */
        #char-3d-container { 
            width: 400px; 
            height: 400px; 
            cursor: grab; 
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.8));
        }
        #char-3d-container:active { cursor: grabbing; }

        .char-name { margin-top: 10px; font-size: 28px; color: #4db8ff; font-weight: bold; text-shadow: 0 0 15px rgba(77, 184, 255, 0.4); }

        /* Lado Derecho: Tienda e Inventario */
        .shop-container { width: 400px; background: #111; border-left: 1px solid #333; padding: 20px; overflow-y: auto; }
        .section-title { font-size: 14px; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        
        .item-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 30px; }
        .item-card { background: #1a1a1a; border: 1px solid #333; padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; }
        .item-card:hover { border-color: #4db8ff; background: #222; transform: translateY(-2px); }
        .item-card.owned { border-color: #4caf50; opacity: 0.8; }
        .item-emoji { font-size: 40px; display: block; margin-bottom: 10px; }
        
        /* Estilo para el icono de la cabeza personalizada */
        .custom-head-icon { width: 50px; height: 50px; margin-bottom: 10px; }

        .item-price { color: #ffca28; font-weight: bold; font-size: 14px; }
        
        .btn-back { position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.05); border: 1px solid #444; color: #888; padding: 8px 20px; border-radius: 5px; cursor: pointer; z-index: 10; transition: 0.3s; }
        .btn-back:hover { color: white; border-color: white; background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold; font-size: 20px; letter-spacing: 1px;">üë§ PERFIL DE USUARIO</div>
    <div class="coins">ü™ô <span id="coin-count">500</span></div>
</div>

<div class="main-container">
    <div class="character-view">
        <button class="btn-back" onclick="location.href='index.html'">‚¨Ö VOLVER</button>
        <div id="char-3d-container"></div>
        <div id="user-display-name" class="char-name">Usuario</div>
        <p style="color: #555; font-size: 13px; margin-top: 5px; letter-spacing: 1px;">PERSONAJE ACTUAL</p>
    </div>

    <div class="shop-container">
        <div class="section-title">Personajes Disponibles</div>
        <div class="item-grid" id="shop-items"></div>

        <div class="section-title">Mi Inventario</div>
        <div class="item-grid" id="inventory-items"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
    const userSession = JSON.parse(sessionStorage.getItem("funbox_session"));
    if (!userSession) location.href = "index.html";

    document.getElementById("user-display-name").innerText = userSession.user;

    let coins = parseInt(localStorage.getItem("funbox_coins")) || 500;
    let ownedItems = JSON.parse(localStorage.getItem("funbox_items")) || ["üë§"];
    let currentSkin = localStorage.getItem("funbox_current_skin") || "üë§";

    const shopData = [
        { name: "Ninja", emoji: "ü•∑", price: 200 },
        { name: "Robot", emoji: "ü§ñ", price: 400 },
        { name: "Astronauta", emoji: "üë®‚ÄçüöÄ", price: 600 },
        { name: "Rey", emoji: "ü§¥", price: 1000 },
        { name: "Gato Pro", emoji: "üê±", price: 150 },
        { name: "Cient√≠fico", emoji: "üë®‚Äçüî¨", price: 300 }
    ];

    // Icono SVG de la cabeza Cute para el inventario
    const cuteHeadSVG = `
        <svg class="custom-head-icon" viewBox="0 0 100 100">
            <rect x="5" y="40" width="15" height="30" rx="5" fill="#007ceb" />
            <rect x="80" y="40" width="15" height="30" rx="5" fill="#007ceb" />
            <rect x="20" y="20" width="60" height="60" rx="2" fill="#c4a484" />
            <rect x="20" y="20" width="60" height="15" fill="#3d2b1f" />
            <circle cx="35" cy="55" r="8" fill="black" />
            <circle cx="65" cy="55" r="8" fill="black" />
            <circle cx="38" cy="52" r="3" fill="white" />
            <circle cx="68" cy="52" r="3" fill="white" />
            <circle cx="33" cy="58" r="1" fill="white" />
            <circle cx="63" cy="58" r="1" fill="white" />
        </svg>
    `;

    function updateUI() {
        document.getElementById("coin-count").innerText = coins;
        localStorage.setItem("funbox_coins", coins);
        localStorage.setItem("funbox_items", JSON.stringify(ownedItems));
        localStorage.setItem("funbox_current_skin", currentSkin);
        renderShop();
        renderInventory();
    }

    function renderShop() {
        const container = document.getElementById("shop-items");
        container.innerHTML = "";
        shopData.forEach(item => {
            if (!ownedItems.includes(item.emoji)) {
                const card = document.createElement("div");
                card.className = "item-card";
                card.onclick = () => comprar(item);
                card.innerHTML = `
                    <span class="item-emoji">${item.emoji}</span>
                    <div style="font-size: 12px; margin-bottom: 5px;">${item.name}</div>
                    <div class="item-price">ü™ô ${item.price}</div>
                `;
                container.appendChild(card);
            }
        });
    }

    function renderInventory() {
        const container = document.getElementById("inventory-items");
        container.innerHTML = "";
        ownedItems.forEach(emoji => {
            const card = document.createElement("div");
            card.className = "item-card owned";
            card.onclick = () => { currentSkin = emoji; updateUI(); };
            
            // Si es el skin base, ponemos la cabeza Cute personalizada
            if(emoji === "üë§") {
                card.innerHTML = `
                    ${cuteHeadSVG}
                    <div style="font-size: 10px; color: #4caf50; font-weight: bold;">EQUIPAR</div>
                `;
            } else {
                card.innerHTML = `
                    <span class="item-emoji">${emoji}</span>
                    <div style="font-size: 10px; color: #4caf50; font-weight: bold;">EQUIPAR</div>
                `;
            }
            container.appendChild(card);
        });
    }

    function comprar(item) {
        if (coins >= item.price) {
            coins -= item.price;
            ownedItems.push(item.emoji);
            alert(`¬°Has comprado ${item.name}!`);
            updateUI();
        } else {
            alert("No tienes suficientes monedas.");
        }
    }

    let charGroup;
    function init3D() {
        const container = document.getElementById('char-3d-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(40, 1, 0.1, 1000);
        camera.position.set(0, 0.5, 2.5);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(400, 400);
        container.appendChild(renderer.domElement);

        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 2);
        scene.add(light);

        charGroup = new THREE.Group();
        scene.add(charGroup);

        const head = new THREE.Mesh(
            new THREE.BoxGeometry(0.6, 0.6, 0.6),
            new THREE.MeshStandardMaterial({ color: 0xc4a484 })
        );
        head.position.y = 0.6;

        const hair = new THREE.Mesh(
            new THREE.BoxGeometry(0.65, 0.2, 0.65),
            new THREE.MeshStandardMaterial({ color: 0x3d2b1f })
        );
        hair.position.y = 0.25;
        head.add(hair);

        const eyeGeo = new THREE.CircleGeometry(0.12, 32);
        const eyeMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
        const eL = new THREE.Mesh(eyeGeo, eyeMat);
        eL.position.set(-0.18, -0.08, 0.31);
        const eR = eL.clone(); eR.position.x = 0.18;
        head.add(eL, eR);

        const shine1 = new THREE.Mesh(
            new THREE.CircleGeometry(0.04, 16),
            new THREE.MeshBasicMaterial({ color: 0xffffff })
        );
        shine1.position.set(0.04, 0.04, 0.01);
        eL.add(shine1); eR.add(shine1.clone());

        const shine2 = new THREE.Mesh(
            new THREE.CircleGeometry(0.015, 16),
            new THREE.MeshBasicMaterial({ color: 0xffffff })
        );
        shine2.position.set(-0.03, -0.04, 0.01);
        eL.add(shine2); eR.add(shine2.clone());

        const phoneGeo = new THREE.CylinderGeometry(0.15, 0.15, 0.1, 32);
        const phoneMat = new THREE.MeshStandardMaterial({ color: 0x007ceb });
        const pL = new THREE.Mesh(phoneGeo, phoneMat);
        pL.rotation.z = Math.PI/2; pL.position.x = -0.35;
        const pR = pL.clone(); pR.position.x = 0.35;
        head.add(pL, pR);

        const body = new THREE.Mesh(
            new THREE.CapsuleGeometry(0.25, 0.5, 4, 12),
            new THREE.MeshStandardMaterial({ color: 0x007ceb })
        );
        body.position.y = 0.05;

        charGroup.add(head, body);

        let isDragging = false;
        let startX = 0;
        container.addEventListener('mousedown', (e) => { isDragging = true; startX = e.clientX; });
        window.addEventListener('mouseup', () => isDragging = false);
        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                charGroup.rotation.y += (e.clientX - startX) * 0.01;
                startX = e.clientX;
            }
        });

        function animate() {
            requestAnimationFrame(animate);
            if (!isDragging) charGroup.rotation.y += 0.005;
            charGroup.position.y = Math.sin(Date.now() * 0.002) * 0.05;
            renderer.render(scene, camera);
        }
        animate();
    }

    updateUI();
    window.onload = init3D;
</script>

</body>
</html>
