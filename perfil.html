<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Funbox - Mi Perfil</title>
    <style>
        body { background: #0a0a0a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { background: #151515; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .coins { background: #ffca28; color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 18px; box-shadow: 0 0 10px rgba(255, 202, 40, 0.3); }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .character-view { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a1a 0%, #050505 100%); position: relative; }
        #char-3d-container { width: 500px; height: 500px; cursor: grab; filter: drop-shadow(0 10px 40px rgba(0,0,0,0.9)); }
        .char-name { margin-top: 10px; font-size: 28px; color: #4db8ff; font-weight: bold; text-shadow: 0 0 15px rgba(77, 184, 255, 0.4); }
        .btn-play-now { margin-top: 20px; background: #4caf50; color: white; border: none; padding: 12px 40px; font-size: 18px; font-weight: bold; border-radius: 30px; cursor: pointer; transition: 0.3s; box-shadow: 0 0 20px rgba(76, 175, 80, 0.4); }
        .btn-play-now:hover { transform: scale(1.05); background: #66bb6a; }
        .shop-container { width: 400px; background: #111; border-left: 1px solid #333; padding: 20px; overflow-y: auto; }
        .item-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .item-card { background: #1a1a1a; border: 1px solid #333; padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; }
        .item-card.selected { border-color: #4caf50; background: rgba(76, 175, 80, 0.1); border-width: 2px; }
        .custom-head-svg { width: 50px; height: 50px; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: bold; font-size: 20px;">ðŸ‘¤ PERFIL DE USUARIO</div>
    <div class="coins">ðŸª™ <span id="coin-count">500</span></div>
</div>

<div class="main-container">
    <div class="character-view">
        <div id="char-3d-container"></div>
        <div id="user-display-name" class="char-name">Usuario</div>
        <button class="btn-play-now" onclick="location.href='play.html'">ðŸŽ® JUGAR AHORA</button>
    </div>
    <div class="shop-container">
        <div style="color: #888; font-size: 12px; margin-bottom: 10px;">MI INVENTARIO</div>
        <div class="item-grid" id="inventory-items"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
    const userSession = JSON.parse(sessionStorage.getItem("funbox_session")) || { user: "Jugador" };
    document.getElementById("user-display-name").innerText = userSession.user;

    const cuteHeadIcon = `<svg class="custom-head-svg" viewBox="0 0 100 100"><rect x="5" y="40" width="12" height="25" rx="4" fill="#007ceb" /><rect x="83" y="40" width="12" height="25" rx="4" fill="#007ceb" /><rect x="17" y="20" width="66" height="60" rx="2" fill="#c4a484" /><rect x="17" y="20" width="66" height="18" fill="#3d2b1f" /><circle cx="35" cy="55" r="9" fill="black" /><circle cx="65" cy="55" r="9" fill="black" /><circle cx="38" cy="52" r="3" fill="white" /><circle cx="68" cy="52" r="3" fill="white" /></svg>`;

    function renderInventory() {
        const container = document.getElementById("inventory-items");
        container.innerHTML = `<div class="item-card selected">${cuteHeadIcon}<div>EQUIPADO</div></div>`;
    }

    function init3D() {
        const container = document.getElementById('char-3d-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(40, 1, 0.1, 1000);
        camera.position.set(0, 0.6, 3.0); // Ajustada para ver pies

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(500, 500);
        container.appendChild(renderer.domElement);

        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 5);
        scene.add(light);

        const charGroup = new THREE.Group();
        scene.add(charGroup);

        // CABEZA CÃšBICA
        const head = new THREE.Mesh(
            new THREE.BoxGeometry(0.7, 0.7, 0.7),
            new THREE.MeshStandardMaterial({ color: 0xc4a484 })
        );
        head.position.y = 0.85;

        // PELO
        const hair = new THREE.Mesh(
            new THREE.BoxGeometry(0.72, 0.22, 0.72),
            new THREE.MeshStandardMaterial({ color: 0x3d2b1f })
        );
        hair.position.y = 0.25;
        head.add(hair);

        // OJOS CUTE
        const eyeGeo = new THREE.CircleGeometry(0.16, 32);
        const eyeMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
        const eL = new THREE.Mesh(eyeGeo, eyeMat);
        eL.position.set(-0.22, -0.05, 0.36);
        const eR = eL.clone();
        eR.position.x = 0.22;

        const shineGeo = new THREE.CircleGeometry(0.05, 16);
        const shineMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const sL = new THREE.Mesh(shineGeo, shineMat);
        sL.position.set(0.06, 0.06, 0.01);
        eL.add(sL);
        eR.add(sL.clone());
        head.add(eL, eR);

        // AURICULARES
        const phoneGeo = new THREE.CylinderGeometry(0.18, 0.18, 0.12, 32);
        const phoneMat = new THREE.MeshStandardMaterial({ color: 0x007ceb });
        const pL = new THREE.Mesh(phoneGeo, phoneMat);
        pL.rotation.z = Math.PI/2;
        pL.position.x = -0.42;
        const pR = pL.clone();
        pR.position.x = 0.42;
        head.add(pL, pR);

        // CUERPO CÃPSULA
        const body = new THREE.Mesh(
            new THREE.CapsuleGeometry(0.32, 0.6, 4, 16),
            new THREE.MeshStandardMaterial({ color: 0x005a9e })
        );
        body.position.y = 0.25;

        // PATAS (Pies redondeados integrados)
        const footGeo = new THREE.SphereGeometry(0.15, 16, 16);
        const footMat = new THREE.MeshStandardMaterial({ color: 0x004070 });
        
        const footL = new THREE.Mesh(footGeo, footMat);
        footL.position.set(-0.15, -0.15, 0);
        footL.scale.y = 0.6; // Hacerlos un poco mÃ¡s planos como zapatos
        
        const footR = footL.clone();
        footR.position.x = 0.15;

        charGroup.add(head, body, footL, footR);
        charGroup.position.y = -0.4;

        let isDragging = false, startX = 0;
        container.onmousedown = (e) => { isDragging = true; startX = e.clientX; };
        window.onmouseup = () => isDragging = false;
        window.onmousemove = (e) => {
            if (isDragging) {
                charGroup.rotation.y += (e.clientX - startX) * 0.01;
                startX = e.clientX;
            }
        };

        function animate() {
            requestAnimationFrame(animate);
            if (!isDragging) charGroup.rotation.y += 0.005;
            charGroup.position.y = -0.4 + Math.sin(Date.now() * 0.002) * 0.05;
            renderer.render(scene, camera);
        }
        animate();
    }

    renderInventory();
    window.onload = init3D;
</script>
</body>
</html>
