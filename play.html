<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Funbox - CÃ¡psula con Vida</title>
<style>
  body { margin:0; overflow:hidden; background: #f0f0f0; }
  #ui {
    position: fixed; top:20px; left:20px; color:#333;
    font-family: 'Arial Rounded MT Bold', sans-serif;
    background: rgba(255, 255, 255, 0.8);
    padding:15px; border-radius:15px; z-index:10;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<div id="ui">
  ðŸŽ® **Funbox v3.0: El Personaje CÃ¡psula**<br>
  WASD: Caminar | **MantÃ©n R: Mirar de frente**<br>
  <small>Â¡Ahora tiene brazos y piernas!</small>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
// 1. CONFIGURACIÃ“N INICIAL
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xddeeff);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// ILUMINACIÃ“N
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const sun = new THREE.DirectionalLight(0xffffff, 0.7);
sun.position.set(5, 10, 5);
sun.castShadow = true;
scene.add(sun);

// SUELO
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(200, 200),
  new THREE.MeshStandardMaterial({color: 0xeeeeee})
);
floor.rotation.x = -Math.PI/2;
floor.receiveShadow = true;
scene.add(floor);

// 2. EL PERSONAJE (LA CÃPSULA ANIMADA)
const player = new THREE.Group();
player.position.y = 0.5;

// MATERIALES
const cuerpoMat = new THREE.MeshStandardMaterial({color: 0xffcc33, roughness: 0.4}); // Amarillo Fun
const pielMat = new THREE.MeshStandardMaterial({color: 0xffcc33});
const ojoMat = new THREE.MeshStandardMaterial({color: 0x222222});
const blancoMat = new THREE.MeshStandardMaterial({color: 0xffffff});

// CUERPO (CÃ¡psula)
const cuerpo = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.8, 4, 16), cuerpoMat);
cuerpo.position.y = 0.6;
cuerpo.castShadow = true;
player.add(cuerpo);

// OJITOS (Detallados)
function crearOjo(x) {
    const ojoGrupo = new THREE.Group();
    const blanco = new THREE.Mesh(new THREE.SphereGeometry(0.12, 16, 16), blancoMat);
    const pupila = new THREE.Mesh(new THREE.SphereGeometry(0.06, 16, 16), ojoMat);
    const brillo = new THREE.Mesh(new THREE.SphereGeometry(0.02, 8, 8), blancoMat);
    
    pupila.position.z = 0.08;
    brillo.position.set(0.03, 0.03, 0.13);
    ojoGrupo.add(blanco, pupila, brillo);
    ojoGrupo.position.set(x, 0.9, 0.35);
    return ojoGrupo;
}
const ojoIzq = crearOjo(-0.15);
const ojoDer = crearOjo(0.15);
player.add(ojoIzq, ojoDer);

// BRAZITOS (Esferas alargadas)
const brazoGeo = new THREE.CapsuleGeometry(0.08, 0.3, 4, 8);
const brazoIzq = new THREE.Mesh(brazoGeo, pielMat);
brazoIzq.position.set(-0.55, 0.6, 0);
const brazoDer = new THREE.Mesh(brazoGeo, pielMat);
brazoDer.position.set(0.55, 0.6, 0);
player.add(brazoIzq, brazoDer);

// PIERNITAS
const piernaGeo = new THREE.CapsuleGeometry(0.12, 0.2, 4, 8);
const piernaIzq = new THREE.Mesh(piernaGeo, pielMat);
piernaIzq.position.set(-0.2, 0.1, 0);
const piernaDer = new THREE.Mesh(piernaGeo, pielMat);
piernaDer.position.set(0.2, 0.1, 0);
player.add(piernaIzq, piernaDer);

scene.add(player);

// 3. CONTROLES
const keys = {};
let yaw = 0;
let step = 0;

window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
document.body.onclick = () => document.body.requestPointerLock();
document.addEventListener("mousemove", e => {
    if(document.pointerLockElement) yaw -= e.movementX * 0.003;
});

// 4. LOOP DE ANIMACIÃ“N
function animate() {
    requestAnimationFrame(animate);

    let dir = new THREE.Vector3();
    let moving = false;
    if(keys.w){ dir.z -= 1; moving = true; }
    if(keys.s){ dir.z += 1; moving = true; }
    if(keys.a){ dir.x -= 1; moving = true; }
    if(keys.d){ dir.x += 1; moving = true; }

    if(moving) {
        const moveDir = dir.normalize().applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
        player.position.addScaledVector(moveDir, 0.1);
        player.rotation.y = yaw + Math.PI;

        // AnimaciÃ³n de caminar
        step += 0.2;
        piernaIzq.rotation.x = Math.sin(step) * 0.8;
        piernaDer.rotation.x = Math.sin(step + Math.PI) * 0.8;
        brazoIzq.rotation.x = Math.sin(step + Math.PI) * 0.5;
        brazoDer.rotation.x = Math.sin(step) * 0.5;
        cuerpo.position.y = 0.6 + Math.abs(Math.sin(step)) * 0.05; // Rebote
    } else {
        // Idle
        step += 0.05;
        cuerpo.position.y = 0.6 + Math.sin(step) * 0.02;
        piernaIzq.rotation.x = 0;
        piernaDer.rotation.x = 0;
        brazoIzq.rotation.z = Math.sin(step) * 0.1 - 0.1;
        brazoDer.rotation.z = -Math.sin(step) * 0.1 + 0.1;
    }

    // CÃMARA R (VISTA FRONTAL)
    let dist = keys.r ? -3.5 : 4.5;
    let height = keys.r ? 1.2 : 2.5;
    const camOffset = new THREE.Vector3(0, height, dist).applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
    camera.position.lerp(player.position.clone().add(camOffset), 0.1);
    camera.lookAt(player.position.clone().add(new THREE.Vector3(0, 0.6, 0)));

    renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
