<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Funbox - Funko con Vida</title>
<style>
  body { margin:0; overflow:hidden; background: #fdfdfd; }
  #ui {
    position: fixed; top:20px; left:20px; color:#444;
    font-family: 'Arial Rounded MT Bold', sans-serif;
    background: rgba(255, 255, 255, 0.9);
    padding:15px; border-radius:20px; z-index:10;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<div id="ui">
  ✨ **Funbox: Versión Animada**<br>
  WASD: Caminar | **C: Agacharse** | **R: Frontal**
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf0f2f5); 

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 0.9));
const light = new THREE.DirectionalLight(0xffffff, 0.6);
light.position.set(5, 10, 5);
light.castShadow = true;
scene.add(light);

const floor = new THREE.Mesh(
    new THREE.CircleGeometry(50, 32), 
    new THREE.MeshStandardMaterial({color: 0xeeeeee})
);
floor.rotation.x = -Math.PI/2;
floor.receiveShadow = true;
scene.add(floor);

// --- PERSONAJE ---
const player = new THREE.Group();
player.position.y = 0.2; 

const matPiel = new THREE.MeshStandardMaterial({color: 0xffdbac});
const matPelo = new THREE.MeshStandardMaterial({color: 0x4e342e}); 
const matRopa = new THREE.MeshStandardMaterial({color: 0x2196f3});
const matOjoNegro = new THREE.MeshBasicMaterial({color: 0x111111});

const cuerpoVisual = new THREE.Group();
player.add(cuerpoVisual);

// CABEZA
const cabeza = new THREE.Mesh(new THREE.BoxGeometry(0.55, 0.5, 0.5), matPiel);
cabeza.position.y = 0.75;
cabeza.castShadow = true;
cuerpoVisual.add(cabeza);

// PELO Y BARBA
const pelo = new THREE.Mesh(new THREE.BoxGeometry(0.58, 0.22, 0.52), matPelo);
pelo.position.y = 0.2;
cabeza.add(pelo);

const barba = new THREE.Mesh(new THREE.BoxGeometry(0.57, 0.15, 0.51), matPelo);
barba.position.y = -0.18;
cabeza.add(barba);

// OJOS PLANOS
const listaOjos = [];
function crearOjo(x) {
    const ojoGroup = new THREE.Group();
    const pupila = new THREE.Mesh(new THREE.CircleGeometry(0.07, 32), matOjoNegro);
    const brillo1 = new THREE.Mesh(new THREE.CircleGeometry(0.022, 16), new THREE.MeshBasicMaterial({color: 0xffffff}));
    brillo1.position.set(0.025, 0.025, 0.001);
    const brillo2 = new THREE.Mesh(new THREE.CircleGeometry(0.01, 16), new THREE.MeshBasicMaterial({color: 0xffffff}));
    brillo2.position.set(-0.02, -0.02, 0.001);
    
    ojoGroup.add(pupila, brillo1, brillo2);
    ojoGroup.position.set(x, -0.02, 0.251);
    listaOjos.push(ojoGroup);
    return ojoGroup;
}
cabeza.add(crearOjo(-0.18), crearOjo(0.18));

// CUERPO
const cuerpo = new THREE.Mesh(new THREE.CapsuleGeometry(0.18, 0.2, 4, 12), matRopa);
cuerpo.position.y = 0.35;
cuerpo.castShadow = true;
cuerpoVisual.add(cuerpo);

// BRAZOS
const brazoI = new THREE.Mesh(new THREE.SphereGeometry(0.065, 16, 16), matPiel);
brazoI.position.set(-0.3, 0.4, 0);
const brazoD = new THREE.Mesh(new THREE.SphereGeometry(0.065, 16, 16), matPiel);
brazoD.position.set(0.3, 0.4, 0);
cuerpoVisual.add(brazoI, brazoD);

// PIERNAS
const piernaI = new THREE.Mesh(new THREE.CapsuleGeometry(0.07, 0.1, 4, 8), new THREE.MeshStandardMaterial({color:0x333333}));
piernaI.position.set(-0.12, 0.1, 0);
const piernaD = new THREE.Mesh(new THREE.CapsuleGeometry(0.07, 0.1, 4, 8), new THREE.MeshStandardMaterial({color:0x333333}));
piernaD.position.set(0.12, 0.1, 0);
player.add(piernaI, piernaD);

scene.add(player);

// --- LÓGICA ---
const keys = {};
let yaw = 0, step = 0;
let blinkTimer = 0;

window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
document.body.onclick = () => document.body.requestPointerLock();
document.addEventListener("mousemove", e => {
    if(document.pointerLockElement) yaw -= e.movementX * 0.003;
});

function animate() {
    requestAnimationFrame(animate);
    let dir = new THREE.Vector3();
    let moving = false;
    if(keys.w){ dir.z -= 1; moving = true; }
    if(keys.s){ dir.z += 1; moving = true; }
    if(keys.a){ dir.x -= 1; moving = true; }
    if(keys.d){ dir.x += 1; moving = true; }

    const isCrouching = keys.c;
    cuerpoVisual.scale.y = THREE.MathUtils.lerp(cuerpoVisual.scale.y, isCrouching ? 0.75 : 1.0, 0.2);

    // LÓGICA DE PESTAÑEO (Aleatorio)
    blinkTimer--;
    if (blinkTimer < 0) blinkTimer = Math.random() * 200 + 100; // Cada 2 a 5 segundos aprox
    
    const isBlinking = blinkTimer < 10; // Pestañea durante 10 frames
    listaOjos.forEach(ojo => {
        ojo.scale.y = THREE.MathUtils.lerp(ojo.scale.y, isBlinking ? 0.1 : 1.0, 0.3);
    });

    if(moving) {
        const moveDir = dir.normalize().applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
        player.position.addScaledVector(moveDir, isCrouching ? 0.04 : 0.08);
        player.rotation.y = THREE.MathUtils.lerp(player.rotation.y, yaw + Math.PI, 0.1);
        step += 0.25;
        
        // Caminata de PIERNAS
        piernaI.rotation.x = Math.sin(step) * 0.8;
        piernaD.rotation.x = Math.sin(step + Math.PI) * 0.8;

        // Movimiento de MANOS (Contrario a las piernas para equilibrio)
        brazoI.position.z = Math.sin(step + Math.PI) * 0.15;
        brazoD.position.z = Math.sin(step) * 0.15;
        brazoI.position.y = 0.4 + Math.abs(Math.cos(step)) * 0.05;
        brazoD.position.y = 0.4 + Math.abs(Math.sin(step)) * 0.05;
        
    } else {
        // RESET SUAVE
        piernaI.rotation.x = THREE.MathUtils.lerp(piernaI.rotation.x, 0, 0.15);
        piernaD.rotation.x = THREE.MathUtils.lerp(piernaD.rotation.x, 0, 0.15);
        brazoI.position.z = THREE.MathUtils.lerp(brazoI.position.z, 0, 0.1);
        brazoD.position.z = THREE.MathUtils.lerp(brazoD.position.z, 0, 0.1);
        brazoI.position.y = THREE.MathUtils.lerp(brazoI.position.y, 0.4, 0.1);
        brazoD.position.y = THREE.MathUtils.lerp(brazoD.position.y, 0.4, 0.1);
        step += 0.05;
    }
    
    // Movimiento de cabeza
    cabeza.position.y = 0.75 + Math.sin(step * 2) * 0.012;

    let dist = keys.r ? -2.2 : 3.2;
    const camOffset = new THREE.Vector3(0, 1.4, dist).applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
    camera.position.lerp(player.position.clone().add(camOffset), 0.1);
    camera.lookAt(player.position.clone().add(new THREE.Vector3(0, 0.6, 0)));

    renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
