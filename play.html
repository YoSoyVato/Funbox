<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estados EspaÃ±oles - Personaje Original</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  #ui {
    position: fixed; top:10px; left:10px; color:white;
    font-family: Arial; background: rgba(0,0,0,0.6);
    padding:10px; border-radius:8px; z-index:10;
  }
</style>
</head>
<body>

<div id="ui">
  ðŸŽ® **Estados EspaÃ±oles RP**<br>
  Personaje original restaurado.
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
// 1. ESCENA
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun = new THREE.DirectionalLight(0xffffff,0.8);
sun.position.set(10,20,10);
scene.add(sun);

// SUELO
const floorSize = 200;
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(floorSize, floorSize),
  new THREE.MeshStandardMaterial({color:0x555555})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// 2. PERSONAJE ORIGINAL (RECONSTRUIDO)
const playerHeight = 1.2;
const player = new THREE.Group();

// Material Ãºnico para que cambie TODO a rojo
const bodyMat = new THREE.MeshStandardMaterial({color:0x00ffcc});

// CUERPO PRINCIPAL
const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, playerHeight), bodyMat);
body.position.y = playerHeight;
player.add(body);

// PIERNAS
const legGeo = new THREE.CylinderGeometry(0.15,0.15,0.5);
const legL = new THREE.Mesh(legGeo, bodyMat);
legL.position.set(-0.15,0.25,0);
player.add(legL);

const legR = new THREE.Mesh(legGeo, bodyMat);
legR.position.set(0.15,0.25,0);
player.add(legR);

// BRAZOS
const armGeo = new THREE.CylinderGeometry(0.12,0.12,0.5);
const armL = new THREE.Mesh(armGeo, bodyMat);
armL.position.set(-0.55,1.15,0);
player.add(armL);

const armR = new THREE.Mesh(armGeo, bodyMat);
armR.position.set(0.55,1.15,0);
player.add(armR);

// OJOS (Se quedan negros)
const eyeMat = new THREE.MeshStandardMaterial({color:0x000000});
const eyeGeo = new THREE.SphereGeometry(0.1);
const eyeL = new THREE.Mesh(eyeGeo, eyeMat);
eyeL.position.set(-0.15,1.6,0.25);
player.add(eyeL);

const eyeR = new THREE.Mesh(eyeGeo, eyeMat);
eyeR.position.set(0.15,1.6,0.25);
player.add(eyeR);

player.position.set(0,5,0);
scene.add(player);

// 3. MOVIMIENTO Y FÃSICAS
let velY = 0;
const gravity = -0.03;
let yaw=0, pitch=0;
let speed = 0.15;
const keys = {};
let pointerLocked = false;

window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
document.body.onclick = () => document.body.requestPointerLock();
document.addEventListener("pointerlockchange", () => pointerLocked = document.pointerLockElement === document.body);
document.addEventListener("mousemove", e=>{
  if(!pointerLocked) return;
  yaw -= e.movementX*0.002;
});

function animate(){
  requestAnimationFrame(animate);

  let dir = new THREE.Vector3();
  if(keys.w) dir.z-=1; if(keys.s) dir.z+=1; if(keys.a) dir.x-=1; if(keys.d) dir.x+=1;
  if(dir.length()>0) player.position.addScaledVector(dir.normalize().applyAxisAngle(new THREE.Vector3(0,1,0), yaw), speed * (keys.shift?2:1));

  velY += gravity;
  player.position.y += velY;

  const limite = floorSize / 2;
  const estaDentro = Math.abs(player.position.x) <= limite && Math.abs(player.position.z) <= limite;

  if (estaDentro) {
      bodyMat.color.set(0x00ffcc); 
      if (player.position.y <= playerHeight) {
          player.position.y = playerHeight;
          velY = 0;
      }
  } else {
      // AQUÃ SE PONE TODO ROJO (Cuerpo, piernas y brazos)
      bodyMat.color.set(0xff0000); 
  }

  if(player.position.y < -50){ player.position.set(0,10,0); velY = 0; }

  const camOffset = new THREE.Vector3(0,2,6).applyAxisAngle(new THREE.Vector3(0,1,0), yaw);
  camera.position.copy(player.position).add(camOffset);
  camera.lookAt(player.position.clone().add(new THREE.Vector3(0, playerHeight, 0)));

  renderer.render(scene,camera);
}
animate();
window.addEventListener("resize", ()=>{camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight);});
</script>
</body>
</html>
